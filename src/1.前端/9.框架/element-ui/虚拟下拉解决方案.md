---
title: 虚拟下拉解决方案
author: 李嘉明
tags:
  - element-ui
createTime: 2024/05/01 15:10:05
permalink: /article/wgtb5128/
---

在项目开发中，使用`element-ui`组件库，使用下拉列表时，发现**原型图与组件提供的效果图有差异**,这个时候就可能需要我们进行 进行`组件组合使用` 比如 `el-checkbox` 与 `el-select` 去进行组合开发。

例子：

![el-checkbox+el-select](/images/element-ui/01.png)

再此基础上，我们考虑到，如果 select 渲染的 option 过多，就会导致性能问题，可能在你页面打开，1~3s 后，你才能真正的去选择。这样 如果老板有要求 😂，那么就要去，优化它。业界最常见的解决 就是 虚拟滚动。 虚拟滚动的原理：<a href="/article/kdz7kuwf/">vue 虚拟滚动插件 vue-virtual-scroller 在这篇文章有解释</a>

:::tip
  写法
:::

```vue
<template>
  <el-select
    v-model="change_content.index"
    placeholder="请选择所需要修改的索引"
    multiple
    collapse-tags
    @change="handleSelect"
  >
    <div style="padding: 0 20px">
      <el-checkbox
        :indeterminate="isIndeterminate"
        v-model="checkAll"
        @change="handleCheckAllChange"
        >全选</el-checkbox
      >
    </div>
    <el-checkbox-group v-model="change_content.index">
      <RecycleScroller
        style="height: 150px; overflow-y: auto"
        class="scroller"
        :items="indexList"
        :item-size="32"
        key-field="id"
      >
        <template v-slot="{ item }">
          <el-option :label="item" :value="item">
            <el-checkbox style="pointer-events: none" :label="item" />
          </el-option>
        </template>
      </RecycleScroller>
    </el-checkbox-group>
  </el-select>
</template>

<script>
// 这里作为演示，正常来说我们将其注册为全局组件，并且样式也在全局引入即可
import 'vue-virtual-scroller/dist/vue-virtual-scroller.css'
import { RecycleScroller } from 'vue-virtual-scroller'

export default {
  components: {
    RecycleScroller
  },
  data() {
    return {
      isIndeterminate: false, // indeterminate 属性用以表示 checkbox 的不确定状态，就是显示效果 为 -
      checkAll: false, // 是都全选
      change_content: {
        index: ''
      },
      indexList: []
    }
  },
  methods: {
    handleSelect() {
      const checkedCount = value.length
      this.checkAll = checkedCount === this.indexList.length
      this.isIndeterminate =
        checkedCount > 0 && checkedCount < this.indexList.length
    },
    handleCheckAllChange(val) {
      const data = [...this.indexList]
      this.change_content.index = val ? data : []
      this.isIndeterminate = false
    },
  }
}
</script>
```


我们可以看到，我们使用了 `RecycleScroller` 组件来实现了我们的虚拟滚动。


> [!CAUTION]
> 重要提示

- ⚠️ el-select与el-checkbox-group的v-model 绑定的值，需相同，绑定同一个变量
- ⚠️ el-option的value与el-checkbox的label绑定的值也需要相同
- ⚠️ el-checkbox 需要使用 style=“pointer-events: none”， 是为了去掉鼠标事件，阻止事件冒泡，触发了两次el-select的change事件